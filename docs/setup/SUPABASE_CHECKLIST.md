# ‚òëÔ∏è –ß–µ–∫–ª–∏—Å—Ç: –ß—Ç–æ –°–¥–µ–ª–∞—Ç—å –≤ Supabase

## –ü—Ä–æ—Å—Ç–∞—è –ü—Ä–æ–≤–µ—Ä–∫–∞ (–ù–∞—á–Ω–∏—Ç–µ –ó–¥–µ—Å—å)

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
```
https://app.supabase.com
‚Üí –í–∞—à –ø—Ä–æ–µ–∫—Ç
```

### 2. Table Editor ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¢–∞–±–ª–∏—Ü—ã

#### ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `chat_sessions` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
- [ ] **–î–ê** ‚Üí –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–ª–æ–Ω–æ–∫ –Ω–∏–∂–µ
- [ ] **–ù–ï–¢** ‚Üí [–î–µ–π—Å—Ç–≤–∏–µ A](#–¥–µ–π—Å—Ç–≤–∏–µ-a-—Å–æ–∑–¥–∞—Ç—å-–±–∞–∑–æ–≤—ã–µ-—Ç–∞–±–ª–∏—Ü—ã)

#### ‚úÖ –í `chat_sessions` –µ—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∞ `project_id`?
- [ ] **–î–ê** ‚Üí ‚ú® **–í—Å—ë –≥–æ—Ç–æ–≤–æ! –ù–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!**
- [ ] **–ù–ï–¢** ‚Üí [–î–µ–π—Å—Ç–≤–∏–µ B](#–¥–µ–π—Å—Ç–≤–∏–µ-b-–¥–æ–±–∞–≤–∏—Ç—å-project_id)

#### ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `projects` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
- [ ] **–î–ê** ‚Üí –û—Ç–ª–∏—á–Ω–æ!
- [ ] **–ù–ï–¢** ‚Üí [–î–µ–π—Å—Ç–≤–∏–µ B](#–¥–µ–π—Å—Ç–≤–∏–µ-b-–¥–æ–±–∞–≤–∏—Ç—å-project_id)

---

## –î–µ–π—Å—Ç–≤–∏—è

### –î–µ–π—Å—Ç–≤–∏–µ A: –°–æ–∑–¥–∞—Ç—å –ë–∞–∑–æ–≤—ã–µ –¢–∞–±–ª–∏—Ü—ã

**–ö–æ–≥–¥–∞:** –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü `chat_sessions` –∏ `chat_messages` –Ω–µ—Ç

**–®–∞–≥–∏:**
1. SQL Editor ‚Üí New Query
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: `supabase/migrations/20241110000000_create_chat_tables.sql`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–í–°–Å** —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
5. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ Ctrl+Enter)
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: ‚úÖ "Success. No rows returned"

**–ó–∞—Ç–µ–º:** –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ [–î–µ–π—Å—Ç–≤–∏—é B](#–¥–µ–π—Å—Ç–≤–∏–µ-b-–¥–æ–±–∞–≤–∏—Ç—å-project_id)

---

### –î–µ–π—Å—Ç–≤–∏–µ B: –î–æ–±–∞–≤–∏—Ç—å project_id

**–ö–æ–≥–¥–∞:** –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ `chat_sessions` –µ—Å—Ç—å, –Ω–æ –∫–æ–ª–æ–Ω–∫–∏ `project_id` –Ω–µ—Ç

**–®–∞–≥–∏:**
1. SQL Editor ‚Üí New Query
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: `supabase/migrations/20241111100000_add_projects_and_documents.sql`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–í–°–Å** —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
5. –ù–∞–∂–º–∏—Ç–µ **Run**
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: ‚úÖ "Success"

**–ó–∞—Ç–µ–º:** –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ [–§–∏–Ω–∞–ª—å–Ω–æ–π –ü—Ä–æ–≤–µ—Ä–∫–µ](#—Ñ–∏–Ω–∞–ª—å–Ω–∞—è-–ø—Ä–æ–≤–µ—Ä–∫–∞)

---

## –§–∏–Ω–∞–ª—å–Ω–∞—è –ü—Ä–æ–≤–µ—Ä–∫–∞

### –í Table Editor –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:

```
‚úÖ chat_sessions
   ‚îú‚îÄ id
   ‚îú‚îÄ user_id
   ‚îú‚îÄ project_id          ‚Üê –ö–†–ò–¢–ò–ß–ù–û!
   ‚îú‚îÄ initial_message
   ‚îú‚îÄ created_at
   ‚îú‚îÄ utm
   ‚îî‚îÄ document_type

‚úÖ chat_messages
   ‚îú‚îÄ id
   ‚îú‚îÄ session_id
   ‚îú‚îÄ role
   ‚îú‚îÄ content
   ‚îî‚îÄ created_at

‚úÖ projects
   ‚îú‚îÄ id
   ‚îú‚îÄ user_id
   ‚îú‚îÄ name
   ‚îú‚îÄ slug
   ‚îú‚îÄ created_at
   ‚îî‚îÄ updated_at

‚úÖ project_documents
   ‚îú‚îÄ id
   ‚îú‚îÄ project_id
   ‚îú‚îÄ name
   ‚îú‚îÄ mime_type
   ‚îî‚îÄ ... (–¥—Ä—É–≥–∏–µ –∫–æ–ª–æ–Ω–∫–∏)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –î–∞–Ω–Ω—ã—Ö

SQL Editor ‚Üí Run:

```sql
-- –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫:
SELECT COUNT(*) FROM chat_sessions;
SELECT COUNT(*) FROM chat_messages;
SELECT COUNT(*) FROM projects;
SELECT COUNT(*) FROM project_documents;
```

---

## –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ú–∏–≥—Ä–∞—Ü–∏—è –°—Ç–∞—Ä—ã—Ö –î–∞–Ω–Ω—ã—Ö

**–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —É –≤–∞—Å –±—ã–ª–∏ —Å—Ç–∞—Ä—ã–µ —á–∞—Ç—ã –ë–ï–ó –ø—Ä–æ–µ–∫—Ç–æ–≤**

```sql
-- –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —á–∞—Ç–æ–≤
WITH new_project AS (
  INSERT INTO projects (name, user_id)
  VALUES ('–°—Ç–∞—Ä—ã–µ —á–∞—Ç—ã', NULL)
  RETURNING id
)
UPDATE chat_sessions
SET project_id = (SELECT id FROM new_project)
WHERE project_id IS NULL;
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ! –ß—Ç–æ –î–∞–ª—å—à–µ?

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ Supabase:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env.local:**
   ```bash
   cat .env.local
   # –î–æ–ª–∂–Ω—ã –±—ã—Ç—å: NEXT_PUBLIC_SUPABASE_URL –∏ NEXT_PUBLIC_SUPABASE_ANON_KEY
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   npm run dev
   ```

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
   - –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç
   - –°–æ–∑–¥–∞–π—Ç–µ —á–∞—Ç
   - –û—á–∏—Å—Ç–∏—Ç–µ localStorage (DevTools ‚Üí Application ‚Üí Clear)
   - –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
   - ‚úÖ –ß–∞—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è!

---

## üÜò –ü–æ–º–æ—â—å

### "–£ –º–µ–Ω—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ SQL"

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:**
- `already exists` ‚Üí –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, —Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ –µ—Å—Ç—å
- `permission denied` ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- `syntax error` ‚Üí –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ –í–°–Å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞

### "–ù–µ –∑–Ω–∞—é, –µ—Å—Ç—å –ª–∏ —É –º–µ–Ω—è project_id"

**SQL Editor ‚Üí Run:**
```sql
SELECT column_name 
FROM information_schema.columns 
WHERE table_name = 'chat_sessions';
```

–ï—Å–ª–∏ –≤ —Å–ø–∏—Å–∫–µ –µ—Å—Ç—å `project_id` ‚Üí ‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ!

### "–ë–æ—é—Å—å —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞—Ç—å"

**–ù–µ –±–æ–π—Ç–µ—Å—å!** –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
- `CREATE TABLE IF NOT EXISTS` - —Å–æ–∑–¥–∞—Å—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç
- `ADD COLUMN IF NOT EXISTS` - –¥–æ–±–∞–≤–∏—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç
- –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–π –°—Ç–∞—Ç—É—Å

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –æ—Ç–º–µ—Ç—å—Ç–µ:

- [ ] –í—Å–µ 4 —Ç–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- [ ] –í `chat_sessions` –µ—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∞ `project_id`
- [ ] SQL –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] .env.local –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] –¢–µ—Å—Ç —Å –æ—á–∏—Å—Ç–∫–æ–π localStorage –ø—Ä–æ—à–µ–ª

**–í—Å—ë –æ—Ç–º–µ—á–µ–Ω–æ?** üéâ **–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –î–∞–Ω–Ω—ã–µ –±–æ–ª—å—à–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è!**

